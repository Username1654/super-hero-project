<!-- views/heroList.ejs -->
<!-- <%const heroes = Superman = [{superName: "SuperMan",realName: "Clark Kent",superpower: "Super strength, flying, lazer eyes, super breath, super vision and super hearing.",powerLevel: "10",secredIdentity: "yes",},{superName: "SuperMan",realName: "Clark Kent",superpower: "Super strength, flying, lazer eyes, super breath, super vision and super hearing.",powerLevel: "10",secredIdentity: "yes",}];%> -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>super hero List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <h1>Heroes</h1>
<div  id="hero-list">
    <% heroess.forEach(hero => { %>
      <ul class="list-group" style="width: 300px;" id="hero-<%= hero._id %>">
        <li class="list-group-item active">Super Name:<strong> <%= hero.superName %></strong></i>
        <li class="list-group-item">Real Name:<strong> <%= hero.realName %></strong></i>
        <li class="list-group-item">Superpower:<strong> <%= hero.superpower %></strong></i>
        <li class="list-group-item">Power Level:<strong> <%= hero.powerLevel %></strong></i>
        <li class="list-group-item"></i>
          <button onclick="deleteHero('<%= hero._id %>')">Delete</button>
           <button onclick="editHero('<%= hero._id %>')">Edit</button>
      </ul>

      <br>
    <% }) %>
    </div>
  <button type="button" id="redir">Add hero</button>
  <script>
    document.getElementById('redir').onclick = function() {
      window.location.href = '/superheroform';
    };
function deleteHero(id) {
  fetch(`/heroes/${id}`, { method: 'DELETE' })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
      } else {
        alert('Failed to delete hero');
      }
    })
    .catch(err => console.error(err));
}
function editHero(id) {
  const heroEl = document.getElementById(`hero-${id}`);
  
  // Grab current values
  const superName = heroEl.querySelector('li:nth-child(1) strong').innerText;
  const realName = heroEl.querySelector('li:nth-child(2) strong').innerText;
  
  // Replace with input fields
  heroEl.innerHTML = `
    Super Name: <input type="text" id="edit-superName-${id}" >
    Real Name: <input type="text" id="edit-realName-${id}" >
    <button onclick="saveHero('${id}')">Save</button>
  `;
}
async function saveHero(id) {
  const superName = document.getElementById(`edit-superName-${id}`).value;
  const realName = document.getElementById(`edit-realName-${id}`).value;

  const res = await fetch(`/heroes/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ superName, realName })
  });

  const data = await res.json();
  if (data.success) {
    window.location.reload(); // simple way to refresh the list
  } else {
    alert('Failed to update hero');
  }
}
  </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>